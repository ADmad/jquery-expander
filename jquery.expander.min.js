/*!
 * jQuery Expander Plugin v1.0pre
 *
 * Date: Sun Sep 11 17:22:10 2011 EDT
 * Requires: jQuery v1.3+
 *
 * Copyright 2011, Karl Swedberg
 * Dual licensed under the MIT and GPL licenses (just like jQuery):
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 *
 *
 *
*/
(function(c){c.expander={version:"1.0pre",defaults:{slicePoint:100,preserveWords:true,widow:4,expandText:"read more",expandPrefix:"&hellip; ",summaryClass:"summary",detailClass:"details",moreClass:"read-more",lessClass:"read-less",collapseTimer:0,expandEffect:"fadeIn",expandSpeed:250,userCollapse:true,userCollapseText:"read less",userCollapsePrefix:" ",onSlice:null,beforeExpand:null,afterExpand:null,onCollapse:null}};c.fn.expander=function(D){function E(b,d){var g=d?"div":"span";return[b.summary,
d?"":b.moreLabel,"<"+g,' class="'+b.detailClass+'">',b.details,"</"+g+">"].join("")}function t(b,d){if(b.lastIndexOf("<")>b.lastIndexOf(">"))b=b.slice(0,b.lastIndexOf("<"));if(d)b=b.replace(F,"");return b}function u(b,d){d.hide();d.prev("span."+b.moreClass).show().length||d.parent().children("div."+b.summaryClass).show().find("span."+b.moreClass).show()}function G(b,d,g){if(b.collapseTimer)v=setTimeout(function(){u(b,d);c.isFunction(b.onCollapse)&&b.onCollapse.call(g,false)},b.collapseTimer)}var w=
c.extend({},c.expander.defaults,D),H=/^<(?:area|br|col|embed|hr|img|input|link|meta|param).*>$/i,F=/(&(?:[^;]+;)?|\w+)$/,I=/<\/?(\w+)[^>]*>/g,x=/<(\w+)[^>]*>/g,y=/<\/(\w+)>/g,J=/^<[^>]+>.?/,v;this.each(function(){var b,d,g,p,j,k,s,z=[],q=[],l={},m=this,f=c(this),A=c([]),a=c.meta?c.extend({},w,f.data()):w,n=!!f.find("*").filter(function(){return/^block|table|list/.test(c(this).css("display"))}).length,r=(n?"div":"span")+"."+a.detailClass,K="span."+a.moreClass,L=a.expandSpeed||0,o=c.trim(f.html());
b=c.trim(f.text());var e=o.slice(0,a.slicePoint);if(!(b.length<=a.slicePoint)){c.each(["onSlice","beforeExpand","afterExpand","onCollapse"],function(h,i){l[i]=c.isFunction(a[i])});e=t(e);for(summTagless=e.replace(I,"").length;summTagless<a.slicePoint;){newChar=o.charAt(e.length);if(newChar=="<")newChar=o.slice(e.length).match(J)[0];e+=newChar;summTagless++}e=t(e,a.preserveWords);p=e.match(x)||[];j=e.match(y)||[];g=[];c.each(p,function(h,i){H.test(i)||g.push(i)});p=g;d=j.length;for(b=0;b<d;b++)j[b]=
j[b].replace(y,"$1");c.each(p,function(h,i){var B=i.replace(x,"$1"),C=c.inArray(B,j);if(C===-1){z.push(i);q.push("</"+B+">")}else j.splice(C,1)});q.reverse();if(!f.find(r).length){d=o.slice(e.length);if(d.split(/\s+/).length<a.widow)return;b=q.pop()||"";e+=q.join("");d=z.join("")+d;a.moreLabel='<span class="'+a.moreClass+'">'+a.expandPrefix;a.moreLabel+='<a href="#">'+a.expandText+"</a></span>";if(n){e='<div class="'+a.summaryClass+'">'+e+a.moreLabel;e+=b+"</div>";d=o;a.expandPrefix=""}else e+=b;
a.summary=e;a.details=d;if(l.onSlice)a=(g=a.onSlice.call(m,a))&&g.details?g:a;n=E(a,n);f.html(n)}k=f.find(r);s=f.find(K);k.hide();s.find("a").bind("click.expander",function(h){h.preventDefault();s.hide();A.hide();l.beforeExpand&&a.beforeExpand.call(m);k[a.expandEffect](L,function(){k.css({zoom:""});l.afterExpand&&a.afterExpand.call(m);G(a,k,m)})});A=f.find("div."+a.summaryClass);if(a.userCollapse&&!f.find("span."+a.lessClass).length){f.find(r).append('<span class="'+a.lessClass+'">'+a.userCollapsePrefix+
'<a href="#">'+a.userCollapseText+"</a></span>");f.find("span."+a.lessClass+" a").bind("click.expander",function(h){h.preventDefault();clearTimeout(v);h=c(this).closest(r);u(a,h);l.onCollapse&&a.onCollapse.call(m,true)})}}});return this};c.fn.expander.defaults=c.expander.defaults})(jQuery);
