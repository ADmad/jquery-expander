/*!
 * jQuery Expander Plugin v1.2pre
 *
 * Date: Fri Sep 16 16:07:08 2011 EDT
 * Requires: jQuery v1.3+
 *
 * Copyright 2011, Karl Swedberg
 * Dual licensed under the MIT and GPL licenses (just like jQuery):
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 *
 *
 *
*/
(function(c){c.expander={version:"1.2pre",defaults:{slicePoint:100,preserveWords:true,widow:4,expandText:"read more",expandPrefix:"&hellip; ",summaryClass:"summary",detailClass:"details",moreClass:"read-more",lessClass:"read-less",collapseTimer:0,expandEffect:"fadeIn",expandSpeed:250,collapseEffect:"fadeOut",collapseSpeed:200,userCollapse:true,userCollapseText:"read less",userCollapsePrefix:" ",onSlice:null,beforeExpand:null,afterExpand:null,onCollapse:null}};c.fn.expander=function(E){function F(a,
e){var g=e?"div":"span";return[a.summary,e?"":a.moreLabel,"<"+g,' class="'+a.detailClass+'">',a.details,"</"+g+">"].join("")}function u(a,e){if(a.lastIndexOf("<")>a.lastIndexOf(">"))a=a.slice(0,a.lastIndexOf("<"));if(e)a=a.replace(G,"");return a}function v(a,e){e[a.collapseEffect](a.collapseSpeed,function(){e.prev("span."+a.moreClass).show().length||e.parent().children("div."+a.summaryClass).show().find("span."+a.moreClass).show()})}function H(a,e,g){if(a.collapseTimer)w=setTimeout(function(){v(a,
e);c.isFunction(a.onCollapse)&&a.onCollapse.call(g,false)},a.collapseTimer)}var x=c.extend({},c.expander.defaults,E),I=/^<(?:area|br|col|embed|hr|img|input|link|meta|param).*>$/i,G=/(&(?:[^;]+;)?|\w+)$/,J=/<\/?(\w+)[^>]*>/g,y=/<(\w+)[^>]*>/g,z=/<\/(\w+)>/g,K=/^<[^>]+>.?/,w;this.each(function(){var a,e,g,q,j,k,l,t,A=[],r=[],m={},n=this,f=c(this),B=c([]),b=c.meta?c.extend({},x,f.data()):x;k=!!f.find("."+b.detailClass).length;var o=!!f.find("*").filter(function(){return/^block|table|list/.test(c(this).css("display"))}).length,
s=(o?"div":"span")+"."+b.detailClass,L="span."+b.moreClass,M=b.expandSpeed||0,p=c.trim(f.html());a=c.trim(f.text());var d=p.slice(0,b.slicePoint);if(!(a.length<=b.slicePoint&&!k)){c.each(["onSlice","beforeExpand","afterExpand","onCollapse"],function(h,i){m[i]=c.isFunction(b[i])});d=u(d);for(summTagless=d.replace(J,"").length;summTagless<b.slicePoint;){newChar=p.charAt(d.length);if(newChar=="<")newChar=p.slice(d.length).match(K)[0];d+=newChar;summTagless++}d=u(d,b.preserveWords);q=d.match(y)||[];j=
d.match(z)||[];g=[];c.each(q,function(h,i){I.test(i)||g.push(i)});q=g;e=j.length;for(a=0;a<e;a++)j[a]=j[a].replace(z,"$1");c.each(q,function(h,i){var C=i.replace(y,"$1"),D=c.inArray(C,j);if(D===-1){A.push(i);r.push("</"+C+">")}else j.splice(D,1)});r.reverse();if(!f.find(s).length){a=p.slice(d.length);if(a.split(/\s+/).length<b.widow&&!k)return;k=r.pop()||"";d+=r.join("");a=A.join("")+a;b.moreLabel='<span class="'+b.moreClass+'">'+b.expandPrefix;b.moreLabel+='<a href="#">'+b.expandText+"</a></span>";
if(o){d='<div class="'+b.summaryClass+'">'+d+b.moreLabel;d+=k+"</div>";a=p;b.expandPrefix=""}else d+=k;b.summary=d;b.details=a;if(m.onSlice)b=(g=b.onSlice.call(n,b))&&g.details?g:b;o=F(b,o);f.html(o)}l=f.find(s);t=f.find(L);l.hide();t.find("a").unbind("click.expander").bind("click.expander",function(h){h.preventDefault();t.hide();B.hide();m.beforeExpand&&b.beforeExpand.call(n);l.stop(false,true)[b.expandEffect](M,function(){l.css({zoom:""});m.afterExpand&&b.afterExpand.call(n);H(b,l,n)})});B=f.find("div."+
b.summaryClass);b.userCollapse&&!f.find("span."+b.lessClass).length&&f.find(s).append('<span class="'+b.lessClass+'">'+b.userCollapsePrefix+'<a href="#">'+b.userCollapseText+"</a></span>");f.find("span."+b.lessClass+" a").unbind("click.expander").bind("click.expander",function(h){h.preventDefault();clearTimeout(w);h=c(this).closest(s);v(b,h);m.onCollapse&&b.onCollapse.call(n,true)})}});return this};c.fn.expander.defaults=c.expander.defaults})(jQuery);
